<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <title>التوأم الرقمي — مدينة عنه</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- model-viewer -->
  <script type="module"
    src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js">
  </script>

  <style>
    :root{
      --bg:#eef2f7;
      --card:#ffffff;
      --txt:#0f172a;
      --muted:#64748b;
      --brand:#1d4ed8;
      --shadow:0 14px 40px rgba(0,0,0,.12);
    }

    html,body{
      margin:0;
      height:100%;
      background:var(--bg);
      font-family:system-ui,-apple-system,Segoe UI,Arial;
    }

    .wrap{
      position:fixed;
      inset:0;
      display:grid;
      grid-template-rows:auto 1fr auto;
      gap:12px;
      padding:14px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background:rgba(255,255,255,.9);
      backdrop-filter:blur(10px);
      border:1px solid #e2e8f0;
      border-radius:14px;
      padding:10px 12px;
      box-shadow:var(--shadow);
    }

    .title b{font-size:14px;color:var(--txt)}
    .title span{font-size:12px;color:var(--muted)}

    .actions{display:flex;gap:8px}

    button{
      border:0;
      border-radius:12px;
      padding:10px 14px;
      cursor:pointer;
      font-weight:700;
    }

    .ghost{
      background:#fff;
      border:1px solid #e2e8f0;
      color:var(--txt);
    }

    .primary{
      background:var(--brand);
      color:#fff;
    }

    .stage{
      position:relative;
      overflow:hidden;
      border-radius:18px;
      border:1px solid #e2e8f0;
      background:linear-gradient(#f8fafc,#eef2ff);
      box-shadow:var(--shadow);
    }

    model-viewer{
      width:100%;
      height:100%;
      background:transparent;
    }

    .hud{
      position:absolute;
      left:50%;
      top:16px;
      transform:translateX(-50%);
      background:rgba(0,0,0,.75);
      color:#fff;
      padding:10px 14px;
      border-radius:12px;
      display:flex;
      align-items:center;
      gap:10px;
      z-index:10;
    }

    .bar{
      width:220px;
      height:8px;
      background:rgba(255,255,255,.25);
      border-radius:999px;
      overflow:hidden;
    }

    .bar div{
      height:100%;
      width:0%;
      background:#7dd3fc;
    }

    .hint{
      position:absolute;
      left:16px;
      bottom:16px;
      background:rgba(255,255,255,.95);
      border:1px solid #e2e8f0;
      border-radius:14px;
      padding:10px 12px;
      font-size:13px;
      box-shadow:var(--shadow);
    }

    .footer{
      font-size:12px;
      color:var(--muted);
      display:flex;
      justify-content:space-between;
      padding:0 4px;
    }

    a{color:var(--brand);text-decoration:none;font-weight:700}
  </style>
</head>

<body>
<div class="wrap">

  <!-- Top bar -->
  <div class="topbar">
    <div class="title">
      <b>التوأم الرقمي — مدينة عنه</b>
      <span id="status">تحميل النموذج…</span>
    </div>
    <div class="actions">
      <button class="ghost" id="btnAuto">Auto-Fit</button>
      <button class="ghost" id="btnHotspots">Hotspots</button>
      <button class="primary" id="btnReset">Reset</button>
    </div>
  </div>

  <!-- Stage -->
  <div class="stage">

    <div class="hud" id="hud">
      <span id="hudText">Loading…</span>
      <div class="bar"><div id="pbar"></div></div>
    </div>

    <!-- ✅ model-viewer -->
    <model-viewer
      id="mv"
      src="./Anahcity_2.0.glb"
      alt="Anah Digital Twin"

      camera-controls
      interaction-prompt="none"
      loading="eager"
      reveal="auto"

      auto-rotate="false"
      rotation-per-second="0deg"

      camera-orbit="45deg 65deg auto"
      min-camera-orbit="auto auto 5m"
      max-camera-orbit="auto auto 2000m"
      field-of-view="45deg"

      environment-image="none"
      exposure="1.15"
      shadow-intensity="0.4"
      shadow-softness="0.6"

      disable-zoom="false"
      ar="false">
    </model-viewer>

    <div class="hint">
      <b>التحكم:</b><br>
      يسار ماوس: تدوير · عجلة: تكبير · يمين ماوس: سحب
    </div>

  </div>

  <!-- Footer -->
  <div class="footer">
    <div>Digital Twin Viewer — model-viewer</div>
    <div><a href="./Anahcity_2.0.glb" target="_blank">Open model</a></div>
  </div>

</div>

<script>
  const mv = document.getElementById('mv');
  const hud = document.getElementById('hud');
  const hudText = document.getElementById('hudText');
  const pbar = document.getElementById('pbar');
  const status = document.getElementById('status');

  const btnReset = document.getElementById('btnReset');
  const btnAuto = document.getElementById('btnAuto');

  mv.addEventListener('progress', (e) => {
    const pct = Math.round((e.detail.totalProgress || 0) * 100);
    hudText.textContent = `Loading… ${pct}%`;
    status.textContent = `تحميل النموذج: ${pct}%`;
    pbar.style.width = pct + '%';
  });

  mv.addEventListener('load', () => {
    hudText.textContent = 'Loaded';
    status.textContent = 'تم التحميل 100%';
    pbar.style.width = '100%';
    setTimeout(()=>hud.style.display='none',600);
    mv.jumpCameraToGoal();
  });

  btnReset.onclick = () => {
    mv.cameraOrbit = '45deg 65deg auto';
    mv.fieldOfView = '45deg';
    mv.jumpCameraToGoal();
  };

  btnAuto.onclick = () => {
    mv.cameraOrbit = '35deg 60deg auto';
    mv.fieldOfView = '40deg';
    mv.jumpCameraToGoal();
  };
</script>

</body>
</html>
