<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>التوأم الرقمي — مدينة عنه</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- model-viewer -->
  <script type="module"
    src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js">
  </script>

  <style>
    html,body{
      margin:0;
      height:100%;
      background:#f1f5f9;
      font-family:system-ui,-apple-system,"Segoe UI",Tahoma;
    }

    .app{
      height:100%;
      display:grid;
      grid-template-rows:auto 1fr auto;
      gap:10px;
      padding:12px;
    }

    .top{
      background:#ffffff;
      border-radius:14px;
      padding:10px 14px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      box-shadow:0 8px 24px rgba(0,0,0,.08);
    }

    .top b{font-size:15px}
    .top span{font-size:12px;color:#64748b}

    .actions button{
      border:0;
      padding:8px 12px;
      border-radius:10px;
      cursor:pointer;
      font-weight:700;
      margin-inline-start:6px;
    }

    .actions .ghost{
      background:#f1f5f9;
    }
    .actions .primary{
      background:#2563eb;
      color:#fff;
    }

    .stage{
      position:relative;
      background:linear-gradient(#f8fafc,#eef2f7);
      border-radius:18px;
      overflow:hidden;
      box-shadow:0 12px 32px rgba(0,0,0,.12);
    }

    model-viewer{
      width:100%;
      height:100%;
      background:transparent;
    }

    .loading{
      position:absolute;
      top:14px;
      left:50%;
      transform:translateX(-50%);
      background:#111827;
      color:#fff;
      padding:8px 14px;
      border-radius:12px;
      font-size:13px;
      display:flex;
      align-items:center;
      gap:10px;
    }

    .bar{
      width:180px;
      height:6px;
      background:#374151;
      border-radius:999px;
      overflow:hidden;
    }

    .bar div{
      height:100%;
      width:0%;
      background:#38bdf8;
    }

    .hint{
      position:absolute;
      bottom:14px;
      left:14px;
      background:#ffffff;
      border-radius:14px;
      padding:10px 12px;
      font-size:13px;
      box-shadow:0 8px 24px rgba(0,0,0,.12);
    }

    .footer{
      font-size:12px;
      color:#64748b;
      text-align:center;
    }
  </style>
</head>

<body>
<div class="app">

  <!-- Top bar -->
  <div class="top">
    <div>
      <b>التوأم الرقمي — مدينة عنه</b><br>
      <span id="status">جاري التحميل…</span>
    </div>
    <div class="actions">
      <button class="ghost" id="btnFit">Auto-Fit</button>
      <button class="primary" id="btnReset">Reset</button>
    </div>
  </div>

  <!-- Stage -->
  <div class="stage">

    <div class="loading" id="loading">
      <span id="pct">0%</span>
      <div class="bar"><div id="bar"></div></div>
    </div>

    <model-viewer
      id="mv"
      src="./Anahcity_2.0.glb"
      alt="Anah Digital Twin"

      camera-controls
      interaction-prompt="none"

      exposure="1.1"
      shadow-intensity="0.4"

      camera-orbit="0deg 75deg auto"
      min-camera-orbit="auto auto 1m"
      max-camera-orbit="auto auto 5000m"
      field-of-view="45deg">
    </model-viewer>

    <div class="hint">
      يسار ماوس: تدوير · عجلة: تكبير · يمين ماوس: سحب
    </div>
  </div>

  <div class="footer">
    Digital Twin Viewer — model-viewer
  </div>
</div>

<script>
  const mv = document.getElementById('mv');
  const status = document.getElementById('status');
  const loading = document.getElementById('loading');
  const pct = document.getElementById('pct');
  const bar = document.getElementById('bar');

  const btnFit = document.getElementById('btnFit');
  const btnReset = document.getElementById('btnReset');

  // Progress
  mv.addEventListener('progress', (e)=>{
    const p = Math.round((e.detail.totalProgress || 0) * 100);
    pct.textContent = p + '%';
    bar.style.width = p + '%';
  });

  // Load complete → Auto-Fit حقيقي
  mv.addEventListener('load', async ()=>{
    status.textContent = 'تم التحميل 100%';
    loading.style.display = 'none';

    await mv.updateComplete;
    mv.cameraOrbit = '0deg 75deg auto';
    mv.cameraTarget = 'auto auto auto';
    mv.jumpCameraToGoal();
  });

  // Buttons
  btnFit.onclick = async ()=>{
    await mv.updateComplete;
    mv.cameraOrbit = '0deg 75deg auto';
    mv.cameraTarget = 'auto auto auto';
    mv.jumpCameraToGoal();
  };

  btnReset.onclick = async ()=>{
    await mv.updateComplete;
    mv.cameraOrbit = '0deg 75deg auto';
    mv.cameraTarget = 'auto auto auto';
    mv.jumpCameraToGoal();
  };
</script>

</body>
</html>
