<!doctype html>
<html lang="ar">
<head>
<meta charset="utf-8"/>
<title>Anah Digital Twin</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<link rel="stylesheet"
href="https://cesium.com/downloads/cesiumjs/releases/1.118/Build/Cesium/Widgets/widgets.css"/>
<script src="https://cesium.com/downloads/cesiumjs/releases/1.118/Build/Cesium/Cesium.js"></script>

<style>
html,body,#cesiumContainer{margin:0;width:100%;height:100%}

.panel{
position:absolute;
left:10px;
background:#1f2a30;
color:#fff;
padding:10px;
border-radius:10px;
width:260px;
z-index:10
}
.panel h3{margin:5px 0;font-size:15px}

.layer-item{display:flex;gap:6px;align-items:center;font-size:13px}

button{
width:100%;
margin:4px 0;
padding:6px;
border:none;
border-radius:6px;
background:#37474f;
color:#fff;
cursor:pointer
}
button:hover{background:#455a64}

.info-box{
position:absolute;
bottom:15px;
left:15px;
background:rgba(0,0,0,.7);
color:#fff;
padding:10px;
border-radius:10px;
min-width:260px;
z-index:10
}
</style>
</head>

<body>

<div class="panel" style="top:60px">
<h3>ğŸ˜ï¸ Ø§Ù„Ø§Ø³ØªØ¹Ù…Ø§Ù„Ø§Øª</h3>
<div id="layersPanel"></div>
</div>

<div class="panel" style="top:350px">
<h3>ğŸ“ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù‚ÙŠØ§Ø³</h3>
<button onclick="setMode('coord')">ğŸ“ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª</button>
<button onclick="setMode('distance')">ğŸ“ Ù…Ø³Ø§ÙØ©</button>
<button onclick="setMode('area')">ğŸ“ Ù…Ø³Ø§Ø­Ø©</button>
<button onclick="clearAll()">ğŸ—‘ï¸ Ù…Ø³Ø­</button>
</div>

<div id="cesiumContainer"></div>
<div class="info-box" id="infoBox">Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</div>

<script>
Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIyNWMxYmU5Ni0zZWUwLTRkNDctYjdhMC01NWY1M2RiN2U4NTUiLCJpZCI6MzU3NDMyLCJpYXQiOjE3Njc3MTUyNzB9.HBEzgBC5NskreMa2Fr6mb7cZNW74AX6XkYu-IKDw8WQ";

const viewer=new Cesium.Viewer("cesiumContainer",{
terrainProvider:new Cesium.EllipsoidTerrainProvider(),
timeline:false,animation:false,shadows:true
});

  
viewer.shadows = true;

viewer.scene.shadowMap.enabled = true;
viewer.scene.shadowMap.softShadows = true;

viewer.scene.globe.enableLighting = true;
viewer.scene.globe.depthTestAgainstTerrain = true;

  viewer.clock.currentTime =
  Cesium.JulianDate.fromIso8601("2026-01-16T10:30:00+03:00");

viewer.clock.multiplier = 0;
viewer.clock.shouldAnimate = false;


const handler=new Cesium.ScreenSpaceEventHandler(viewer.canvas);
const infoBox=document.getElementById("infoBox");

let mode=null;
let marker=null;
let activePoints=[];
let activeShape=null;
let entities=[];

/* ================= MODES ================= */
function setMode(m){
clearAll();
mode=m;
}

function clearAll(){
entities.forEach(e=>viewer.entities.remove(e));
entities=[];
activePoints=[];
if(marker){viewer.entities.remove(marker);marker=null;}
infoBox.innerHTML="ØªÙ… Ø§Ù„Ù…Ø³Ø­";
}

/* ================= CLICK ================= */
handler.setInputAction(e=>{
const pos=viewer.scene.pickPosition(e.position);
if(!pos)return;

if(mode==="coord") showCoord(pos);
if(mode==="distance") drawLine(pos);
if(mode==="area") drawArea(pos);

},Cesium.ScreenSpaceEventType.LEFT_CLICK);

/* ================= COORD ================= */
function showCoord(pos){
if(marker) viewer.entities.remove(marker);

marker=viewer.entities.add({
position:pos,
billboard:{
image:"https://cdn-icons-png.flaticon.com/512/684/684908.png",
verticalOrigin:Cesium.VerticalOrigin.BOTTOM,
scale:0.05
}
});

const c=Cesium.Cartographic.fromCartesian(pos);
const lat=Cesium.Math.toDegrees(c.latitude);
const lon=Cesium.Math.toDegrees(c.longitude);
const utm=toUTM(lat,lon);

infoBox.innerHTML=`
<b>Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª</b><br>
N: ${lat.toFixed(6)}<br>
E: ${lon.toFixed(6)}<br><br>
<b>UTM</b><br>
Zone ${utm.zone}${utm.hemisphere}<br>
Lon: ${utm.easting.toFixed(2)} m<br>
Lat: ${utm.northing.toFixed(2)} m`;
}

/* ================= DISTANCE ================= */
function drawLine(pos){
activePoints.push(pos);
if(activePoints.length<2)return;

const d=Cesium.Cartesian3.distance(activePoints[0],activePoints[1]);
infoBox.innerHTML=`ğŸ“ Ø§Ù„Ù…Ø³Ø§ÙØ©: ${(d).toFixed(2)} Ù…`;

activeShape=viewer.entities.add({
polyline:{positions:activePoints,width:3,material:Cesium.Color.YELLOW}
});
entities.push(activeShape);
}

/* ================= AREA ================= */
function drawArea(pos){
activePoints.push(pos);
if(activePoints.length<3)return;

const poly=viewer.entities.add({
polygon:{
hierarchy:activePoints,
material:Cesium.Color.CYAN.withAlpha(.4)
}
});
entities.push(poly);

const area=Cesium.PolygonPipeline.computeArea2D(activePoints);
infoBox.innerHTML=`ğŸ“ Ø§Ù„Ù…Ø³Ø§Ø­Ø©: ${area.toFixed(2)} Ù…Â²`;
}

/* ================= UTM ================= */
function toUTM(lat,lon){
const zone=Math.floor((lon+180)/6)+1;
return{
zone,hemisphere:lat>=0?"N":"S",
easting:(lon+180)*1000,
northing:(lat+90)*1000
};
}

/* ================= LAYERS ================= */
const layers=[
{n:"Residential",c:"#FFF59D",id:4355603},
{n:"Commercial",c:"#E53935",id:4355604},
{n:"Educational",c:"#1E88E5",id:4355606},
{n:"Health",c:"#EC407A",id:4355607},
{n:"GreenArea",c:"#2E7D32",id:4355613},
{n:"Industrial",c:"#8E24AA",id:4355612},
{n:"Religious",c:"#6D4C41",id:4355610},
{n:"Services",c:"#26C6DA",id:4355609},
{n:"Tourist",c:"#8D6E63",id:4355611},
{n:"Public Buildings",c:"#455A64",id:4355599},
{n:"3D Houses",c:"#90CAF9",id:4355597},
{n:"Vertical Buildings",c:"#B0BEC5",id:4355602},
{n:"Roads",c:"#9E9E9E",id:4355615}  
];

const panel=document.getElementById("layersPanel");
let sphere=null;

(async()=>{
for(const l of layers){
const t=await Cesium.Cesium3DTileset.fromIonAssetId(l.id);
viewer.scene.primitives.add(t);
await t.readyPromise;
sphere=sphere?Cesium.BoundingSphere.union(sphere,t.boundingSphere):t.boundingSphere;

const div=document.createElement("div");
div.className="layer-item";
div.innerHTML=`<input type="checkbox" checked>
<div style="width:12px;height:12px;background:${l.c}"></div>${l.n}`;
div.querySelector("input").onchange=e=>t.show=e.target.checked;
panel.appendChild(div);
}
viewer.camera.flyToBoundingSphere(sphere,{duration:3});
})();
</script>
</body>
</html>
